version: '2'
services:
  mongo:
    image: mongo
    ports:
      - '27017:27017'
  rabbitmq:
    image: rabbitmq
  bridge:
    image: storjlabs/bridge
    build:
      context: ../../bridge
      dockerfile: ./dockerfiles/bridge-development.dockerfile
    ports:
      - '6382:6382'
    command: /usr/bin/env npm run start-dev
    environment:
      NODE_ENV: 'develop'
      MONGO_URL:  'mongodb://mongo:27017/__storj-bridge-development'
    volumes:
      - ../../bridge/bin:/bridge/bin
      - ../../bridge/lib:/bridge/lib
      - ../../bridge/index.js:/bridge/index.js
      - ../../bridge/package.json:/bridge/package.json
      - ../../bridge/.nvmrc:/bridge/.nvmrc
    links:
      - mongo
      - rabbitmq
  billing:
    image: storjlabs/billing
    build:
      context: ../../billing
      dockerfile: ./dockerfiles/billing-development.dockerfile
    volumes:
      - ../../billing/lib:/billing/lib
      - ../../billing/bin:/billing/bin
      - ../../billing/index.js:/billing/index.js
      - ../../billing/package.json:/billing/package.json
      - ../../billing/.nvmrc:/billing/.nvmrc
    environment:
      STAGE: development
      MONGO_URL: 'mongodb://mongo:27017/__storj-bridge-development'
    links:
      - mongo
    ports:
      - '3000:3000'
  bridge-gui:
    image: storjlabs/bridge-gui
    build:
      context: ../
      dockerfile: ./dockerfiles/bridge-gui-development.dockerfile
    volumes:
      - ../package.json:/bridge-gui/package.json
      - ../.nvmrc:/bridge-gui/.nvmrc
      - ../.babelrc:/bridge-gui/.babelrc
      - ../server.babel.js:/bridge-gui/server.babel.js
      - ../bin:/bridge-gui/bin
      - ../src:/bridge-gui/src
      - ../scripts:/bridge-gui/scripts
      - ../webpack:/bridge-gui/webpack
    environment:
      STAGE: development
      APOLLO_CLIENT_URL: 'http://billing:3000'
      API_HOST: bridge
      API_PORT: 6382
      HOST: 0.0.0.0
      PORT: 3001
    links:
      - bridge
      - billing
    ports:
      - '3001:3001'
